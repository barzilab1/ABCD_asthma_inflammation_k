---
title: "Cross-sectional models"
author: "Kate Tran"
date: "7/28/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
library(lme4)
library(readr)
library(sjPlot)
```

```{r}
data_wide <- read_csv("../outputs/data_wide_mm.csv")
```

# 1. Check association with CBCL
```{r}
diag_cbcl <- lmer(scale(CBCL_mean) ~ asthma_diagnosis_l_ever + scale(age_2y_years) + (1 | site_id_l_br/rel_family_id), data = data_wide)
diag_bpm <- lmer(scale(BPM_mean) ~ asthma_diagnosis_l_ever + scale(age_2y_years) + (1 | site_id_l_br/rel_family_id), data = data_wide)
tab_model(diag_cbcl, diag_bpm, show.intercept = F)
# Significant associations -> covary for CBCL, BPM
```

# 2. Model function
```{r}
var_mod_1 <- c(
  "scale(age_2y_years)",
  "sex_br",
  "race_white",
  "race_black",
  "race_other",
  "ethnicity_hisp",
  "(1 | site_id_l_br/rel_family_id)"
)

var_mod_2 <- c(
  var_mod_1,
  "scale(household_income)",
  "scale(parents_avg_edu)",
  "scale(devhx_3_p)"
)

var_mod_3 <- c(
  var_mod_2,
  "reshist_addr1_adi_perc",
  "scale(reshist_addr1_popdensity)",
  "scale(reshist_addr1_no2)",
  "scale(reshist_addr1_pm25)",
  "scale(reshist_addr1_proxrd)"
)

get_models <- function(outcome, predictor, variables, var_added = NULL) {
  if (is.null(var_added)) {
    model <- as.formula(paste0(outcome, " ~", paste0(c(
      predictor, variables
    ), collapse = " + ")))
  } else {
    model <- as.formula(paste0(outcome, " ~", paste0(
      c(predictor, variables, var_added), collapse = " + "
    )))
  }
  return(model)
}
```

# 3.1. Outcome suicide attempt - asthma
## 3.1.1. Asthma diagnosis
```{r}
SA_diag_0 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_diagnosis_l_ever", 
                             variables = "(1 | site_id_l_br/rel_family_id)"), 
                      family = binomial, data = data_wide, nAGQ = 0)

SA_diag_1 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_diagnosis_l_ever", variables = var_mod_1), 
                      family = binomial, data = data_wide, nAGQ = 0)

SA_diag_2 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_diagnosis_l_ever", variables = var_mod_2), 
                      family = binomial, data = data_wide, nAGQ = 0)

SA_diag_3 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_diagnosis_l_ever", variables = var_mod_3), 
                      family = binomial, data = data_wide, nAGQ = 0)

SA_diag_4 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_diagnosis_l_ever", variables = var_mod_3, var_added = "scale(CBCL_mean)"),
                   family = binomial, data = data_wide, nAGQ = 0)

SA_diag_5 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_diagnosis_l_ever", variables = var_mod_3, var_added = "scale(BPM_mean)"),
                   family = binomial, data = data_wide, nAGQ = 0)

comb_SA_diag_1 <- tab_model(SA_diag_0, SA_diag_1, SA_diag_2, SA_diag_3, SA_diag_4, SA_diag_5, show.intercept = F)
comb_SA_diag_1
```

## 3.1.2. Asthma attack
```{r}
SA_attack_0 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_attack_l_ever", 
                              variables = "(1 | site_id_l_br/rel_family_id)"), 
                   family = binomial, data = data_wide, nAGQ = 0)

SA_attack_1 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_attack_l_ever", variables = var_mod_1), 
                   family = binomial, data = data_wide, nAGQ = 0)

SA_attack_2 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_attack_l_ever", variables = var_mod_2), 
                   family = binomial, data = data_wide, nAGQ = 0)

SA_attack_3 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_attack_l_ever", variables = var_mod_3), 
                   family = binomial, data = data_wide, nAGQ = 0)

SA_attack_4 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_attack_l_ever", variables = var_mod_3, var_added = "scale(CBCL_mean)"),
                   family = binomial, data = data_wide, nAGQ = 0)

SA_attack_5 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_attack_l_ever", variables = var_mod_3, var_added = "scale(BPM_mean)"),
                   family = binomial, data = data_wide, nAGQ = 0)

comb_SA_attack_1 <- tab_model(SA_attack_0, SA_attack_1, SA_attack_2, SA_attack_3, SA_attack_4, SA_attack_5, show.intercept = F)
comb_SA_attack_1
```

## 3.1.3. Asthma composite
```{r}
SA_comp_0 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_composite_ever", 
                              variables = "(1 | site_id_l_br/rel_family_id)"), 
                   family = binomial, data = data_wide, nAGQ = 0)

SA_comp_1 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_composite_ever", variables = var_mod_1), 
                   family = binomial, data = data_wide, nAGQ = 0)

SA_comp_2 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_composite_ever", variables = var_mod_2), 
                   family = binomial, data = data_wide, nAGQ = 0)

SA_comp_3 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_composite_ever", variables = var_mod_3), 
                   family = binomial, data = data_wide, nAGQ = 0)

SA_comp_4 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_composite_ever", variables = var_mod_3, var_added = "scale(CBCL_mean)"),
                   family = binomial, data = data_wide, nAGQ = 0)

SA_comp_5 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_composite_ever", variables = var_mod_3, var_added = "scale(BPM_mean)"),
                   family = binomial, data = data_wide, nAGQ = 0)

comb_SA_comp_1 <- tab_model(SA_comp_0, SA_comp_1, SA_comp_2, SA_comp_3, SA_comp_4, SA_comp_5, show.intercept = F)
comb_SA_comp_1
```

## 3.1.4. Recently active asthma
```{r}
SA_recent_active_0 <- glmer(get_models(outcome = "SA_y_ever", predictor = "recent_active_asthma_ever", 
                              variables = "(1 | site_id_l_br/rel_family_id)"), 
                   family = binomial, data = data_wide, nAGQ = 0)

SA_recent_active_1 <- glmer(get_models(outcome = "SA_y_ever", predictor = "recent_active_asthma_ever", variables = var_mod_1), 
                   family = binomial, data = data_wide, nAGQ = 0)

SA_recent_active_2 <- glmer(get_models(outcome = "SA_y_ever", predictor = "recent_active_asthma_ever", variables = var_mod_2), 
                   family = binomial, data = data_wide, nAGQ = 0)

SA_recent_active_3 <- glmer(get_models(outcome = "SA_y_ever", predictor = "recent_active_asthma_ever", variables = var_mod_3), 
                   family = binomial, data = data_wide, nAGQ = 0)

SA_recent_active_4 <- glmer(get_models(outcome = "SA_y_ever", predictor = "recent_active_asthma_ever", 
                                       variables = var_mod_3, var_added = "scale(CBCL_mean)"),
                   family = binomial, data = data_wide, nAGQ = 0)

SA_recent_active_5 <- glmer(get_models(outcome = "SA_y_ever", predictor = "recent_active_asthma_ever", 
                                       variables = var_mod_3, var_added = "scale(BPM_mean)"),
                   family = binomial, data = data_wide, nAGQ = 0)

comb_SA_recent_active_1 <- tab_model(SA_recent_active_0, SA_recent_active_1, SA_recent_active_2, SA_recent_active_3, 
                                     SA_recent_active_4, SA_recent_active_5, show.intercept = F)
comb_SA_recent_active_1
```

## 3.1.5. Total number of asthma attacks/Mean number of mediation and SA #asthma_num_attack_sum #Asthma_medications_2w_total_sum
```{r}
Noattack_mean_SA_wholepop_1 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_num_attack_sum",
                                         variables = "(1 | site_id_l_br/rel_family_id)"), 
                              family = binomial, data = data_wide, nAGQ = 0)

Noattack_mean_SA_wholepop_2 <- glmer(get_models(outcome = "SA_y_ever", predictor = "asthma_num_attack_sum",
                                         variables = var_mod_1), 
                              family = binomial, data = data_wide, nAGQ = 0)

Nomedication_mean_SA_wholepop_1 <- glmer(get_models(outcome = "SA_y_ever", predictor = "Asthma_medications_2w_total_sum",
                                             variables = "(1 | site_id_l_br/rel_family_id)"), 
                                  family = binomial, data = data_wide, nAGQ = 0)

Nomedication_mean_SA_wholepop_2 <- glmer(get_models(outcome = "SA_y_ever", predictor = "Asthma_medications_2w_total_sum",
                                             variables = var_mod_1), 
                                  family = binomial, data = data_wide, nAGQ = 0)

tab_model(Noattack_mean_SA_wholepop_1, Noattack_mean_SA_wholepop_2, Nomedication_mean_SA_wholepop_1, Nomedication_mean_SA_wholepop_2, show.intercept = F)
```

# 4.1. Outcome suicide ideation - asthma
## 4.1.1. Asthma diagnosis
```{r}
SI_diag_0 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_diagnosis_l_ever", 
                              variables = "(1 | site_id_l_br/rel_family_id)"), 
                   family = binomial, data = data_wide, nAGQ = 0)

SI_diag_1 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_diagnosis_l_ever", variables = var_mod_1), 
                   family = binomial, data = data_wide, nAGQ = 0)

SI_diag_2 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_diagnosis_l_ever", variables = var_mod_2), 
                   family = binomial, data = data_wide, nAGQ = 0)

SI_diag_3 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_diagnosis_l_ever", variables = var_mod_3), 
                   family = binomial, data = data_wide, nAGQ = 0)

SI_diag_4 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_diagnosis_l_ever", variables = var_mod_3, var_added = "scale(CBCL_mean)"),
                   family = binomial, data = data_wide, nAGQ = 0)

SI_diag_5 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_diagnosis_l_ever", variables = var_mod_3, var_added = "scale(BPM_mean)"),
                   family = binomial, data = data_wide, nAGQ = 0)

comb_SI_diag_1 <- tab_model(SI_diag_0, SI_diag_1, SI_diag_2, SI_diag_3, SI_diag_4, SI_diag_5, show.intercept = F)
comb_SI_diag_1
```

## 4.1.2. Asthma attack
```{r}
SI_attack_0 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_attack_l_ever", 
                                variables = "(1 | site_id_l_br/rel_family_id)"), 
                     family = binomial, data = data_wide, nAGQ = 0)

SI_attack_1 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_attack_l_ever", variables = var_mod_1), 
                     family = binomial, data = data_wide, nAGQ = 0)

SI_attack_2 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_attack_l_ever", variables = var_mod_2), 
                     family = binomial, data = data_wide, nAGQ = 0)

SI_attack_3 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_attack_l_ever", variables = var_mod_3), 
                     family = binomial, data = data_wide, nAGQ = 0)

SI_attack_4 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_attack_l_ever", variables = var_mod_3, var_added = "scale(CBCL_mean)"),
                     family = binomial, data = data_wide, nAGQ = 0)

SI_attack_5 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_attack_l_ever", variables = var_mod_3, var_added = "scale(BPM_mean)"),
                     family = binomial, data = data_wide, nAGQ = 0)

comb_SI_attack_1 <- tab_model(SI_attack_0, SI_attack_1, SI_attack_2, SI_attack_3, SI_attack_4, SI_attack_5, show.intercept = F)
comb_SI_attack_1
```

## 4.1.3. Asthma composite
```{r}
SI_comp_0 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_composite_ever", 
                              variables = "(1 | site_id_l_br/rel_family_id)"), 
                   family = binomial, data = data_wide, nAGQ = 0)

SI_comp_1 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_composite_ever", variables = var_mod_1), 
                   family = binomial, data = data_wide, nAGQ = 0)

SI_comp_2 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_composite_ever", variables = var_mod_2), 
                   family = binomial, data = data_wide, nAGQ = 0)

SI_comp_3 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_composite_ever", variables = var_mod_3), 
                   family = binomial, data = data_wide, nAGQ = 0)

SI_comp_4 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_composite_ever", variables = var_mod_3, var_added = "scale(CBCL_mean)"),
                   family = binomial, data = data_wide, nAGQ = 0)

SI_comp_5 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_composite_ever", variables = var_mod_3, var_added = "scale(BPM_mean)"),
                   family = binomial, data = data_wide, nAGQ = 0)

comb_SI_comp_1 <- tab_model(SI_comp_0, SI_comp_1, SI_comp_2, SI_comp_3, SI_comp_4, SI_comp_5, show.intercept = F)
comb_SI_comp_1
```

## 4.1.4. Recently active asthma
```{r}
SI_recent_active_0 <- glmer(get_models(outcome = "SI_y_ever", predictor = "recent_active_asthma_ever", 
                                       variables = "(1 | site_id_l_br/rel_family_id)"), 
                            family = binomial, data = data_wide, nAGQ = 0)

SI_recent_active_1 <- glmer(get_models(outcome = "SI_y_ever", predictor = "recent_active_asthma_ever", variables = var_mod_1), 
                            family = binomial, data = data_wide, nAGQ = 0)

SI_recent_active_2 <- glmer(get_models(outcome = "SI_y_ever", predictor = "recent_active_asthma_ever", variables = var_mod_2), 
                            family = binomial, data = data_wide, nAGQ = 0)

SI_recent_active_3 <- glmer(get_models(outcome = "SI_y_ever", predictor = "recent_active_asthma_ever", variables = var_mod_3), 
                            family = binomial, data = data_wide, nAGQ = 0)

SI_recent_active_4 <- glmer(get_models(outcome = "SI_y_ever", predictor = "recent_active_asthma_ever", variables = var_mod_3, var_added = "scale(CBCL_mean)"),
                            family = binomial, data = data_wide, nAGQ = 0)

SI_recent_active_5 <- glmer(get_models(outcome = "SI_y_ever", predictor = "recent_active_asthma_ever", variables = var_mod_3, var_added = "scale(BPM_mean)"),
                            family = binomial, data = data_wide, nAGQ = 0)

comb_SI_recent_active_1 <- tab_model(SI_recent_active_0, SI_recent_active_1, SI_recent_active_2, SI_recent_active_3, SI_recent_active_4, SI_recent_active_5, show.intercept = F)
comb_SI_recent_active_1
```

## 4.1.5. Total number of asthma attacks/Mean number of mediation and SA #asthma_num_attack_sum #Asthma_medications_2w_total_sum
```{r}
Noattack_mean_SI_wholepop_1 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_num_attack_sum",
                                         variables = "(1 | site_id_l_br/rel_family_id)"), 
                              family = binomial, data = data_wide, nAGQ = 0)

Noattack_mean_SI_wholepop_2 <- glmer(get_models(outcome = "SI_y_ever", predictor = "asthma_num_attack_sum",
                                         variables = var_mod_1), 
                              family = binomial, data = data_wide, nAGQ = 0)

Nomedication_mean_SI_wholepop_1 <- glmer(get_models(outcome = "SI_y_ever", predictor = "Asthma_medications_2w_total_sum",
                                             variables = "(1 | site_id_l_br/rel_family_id)"), 
                                  family = binomial, data = data_wide, nAGQ = 0)

Nomedication_mean_SI_wholepop_2 <- glmer(get_models(outcome = "SI_y_ever", predictor = "Asthma_medications_2w_total_sum",
                                             variables = var_mod_1), 
                                  family = binomial, data = data_wide, nAGQ = 0)

tab_model(Noattack_mean_SI_wholepop_1, Noattack_mean_SI_wholepop_2, Nomedication_mean_SI_wholepop_1, Nomedication_mean_SI_wholepop_2, show.intercept = F)
```

# 5. Medication - asthma
```{r}
# diagnosis
diag_med_0 <- lmer(get_models(outcome = "Asthma_medications_2w_total_sum", predictor = "asthma_diagnosis_l_ever",  #Asthma_medications_2w_total_mean
                               variables = "(1 | site_id_l_br/rel_family_id)"), data = data_wide)

diag_med_1 <- lmer(get_models(outcome = "Asthma_medications_2w_total_sum", predictor = "asthma_diagnosis_l_ever", 
                               variables = var_mod_1), data = data_wide)

tab_model(diag_med_0, diag_med_1, show.intercept = F)


# attack
attack_med_0 <- lmer(get_models(outcome = "Asthma_medications_2w_total_sum", predictor = "asthma_attack_l_ever", 
                                 variables = "(1 | site_id_l_br/rel_family_id)"), data = data_wide)

attack_med_1 <- lmer(get_models(outcome = "Asthma_medications_2w_total_sum", predictor = "asthma_attack_l_ever", 
                                 variables = var_mod_1), data = data_wide)

tab_model(attack_med_0, attack_med_1, show.intercept = F)


# composite # include medication # no models


# recent active asthma
recent_active_med_0 <- lmer(get_models(outcome = "Asthma_medications_2w_total_sum", predictor = "recent_active_asthma_ever", 
                                        variables = "(1 | site_id_l_br/rel_family_id)"), data = data_wide)

recent_active_med_1 <- lmer(get_models(outcome = "Asthma_medications_2w_total_sum", predictor = "recent_active_asthma_ever", 
                                        variables = var_mod_1), data = data_wide)

tab_model(recent_active_med_0, recent_active_med_1, show.intercept = F)
```

